@extends('admin.index')
@section('content')
<section id="content">
    <section class="hbox stretch">

        <section class="section-layout-2">


            <script src="/module/lophoc/js/jslophoc.js"></script> 
            <section class="vbox">


                <div class="row">
                    <div class="col-sm-12">
                        <div class="menu-option-top1 panel b-a m-b-sm">
                            <div class="row m-n">
                               <div id="menutop_lophoc_waitopen" class="item-menu col-md-2 b-r m-t-xs m-b-xs">
                                <a href="/Default.aspx?mod=lophoc!lophoc_waitopen" class="block hover">
                                    <span class="i-s i-s-1-5x pull-left m-r-xs">
                                        <i class="i i-hexagon2 i-s-base text-success-lt hover-rotate"></i>
                                        <i class="i i-cube icon text-white i-sm"></i>
                                    </span>
                                    <span class="clear">
                                        <span class="h5 block m-t-xs text-success-lt">Lớp học <br> chờ mở  </span>

                                    </span>
                                </a>
                            </div> 
                            <div id="menutop_lophoc" class="item-menu col-md-2 b-r m-t-xs m-b-xs">
                                <a href="/Default.aspx?mod=lophoc!lophoc" class="block hover">
                                    <span class="i-s i-s-1-5x pull-left m-r-xs">
                                        <i class="i i-hexagon2 i-s-base text-primary hover-rotate"></i>
                                        <i class="i i-cube icon text-white i-sm"></i>
                                    </span>
                                    <span class="clear">
                                        <span class="h5 block m-t-xs text-primary">Lớp học <br>  đang học</span>

                                    </span>
                                </a>
                            </div>
                            <div id="menutop_lophoc_end" class="item-menu col-md-2 b-r m-t-xs m-b-xs">
                                <a href="/Default.aspx?mod=lophoc!lophoc_end" class="block hover">
                                    <span class="i-s i-s-1-5x pull-left m-r-xs">
                                        <i class="i i-hexagon2 i-s-base text-warning hover-rotate"></i>
                                        <i class="i i-cube icon text-white i-sm"></i>
                                    </span>
                                    <span class="clear">
                                        <span class="h5 block m-t-xs text-danger">Lớp học <br> đã kết thúc</span>

                                    </span>
                                </a>
                            </div>

                            <div id="menutop_diemdanh" class="item-menu col-md-2 b-r m-t-xs m-b-xs">
                                <a href="/Default.aspx?mod=lophoc!diemdanh" class="block hover">
                                    <span class="i-s i-s-1-5x pull-left m-r-xs">
                                        <i class="i i-hexagon2 i-s-base text-success-lt hover-rotate"></i>
                                        <i class="fa fa-check-circle text-white i-sm"></i>
                                    </span>
                                    <span class="clear">
                                        <span class="h5 block m-t-xs text-success">Điểm danh</span>
                                        <small class="text-muted">Đánh giá ngày</small>
                                    </span>
                                </a>
                            </div> 
                            <div id="menutop_nhapdiem" class="item-menu col-md-2 b-r m-t-xs m-b-xs">
                                <a href="/Default.aspx?mod=lophoc!nhapdiem" class="block hover">
                                    <span class="i-s i-s-1-5x pull-left m-r-xs">
                                        <i class="i i-hexagon2 i-s-base text-success-lt hover-rotate"></i>
                                        <i class="fa fa-edit text-white i-sm"></i>
                                    </span>
                                    <span class="clear">
                                        <span class="h5 block m-t-xs text-success">Nhập điểm</span>
                                        <small class="text-muted">Kết quả học tập</small>
                                    </span>
                                </a>
                            </div> 
                            <div id="menutop_tkb_statics" class="item-menu col-md-2 b-r m-t-xs m-b-xs">
                                <a href="/Default.aspx?mod=lophoc!tkb_statics" class="block hover">
                                    <span class="i-s i-s-1-5x pull-left m-r-xs">
                                        <i class="i i-hexagon2 i-s-base text-success-lt hover-rotate"></i>
                                        <i class="i i-calendar text-white text-white i-sm"></i>
                                    </span>
                                    <span class="clear">
                                        <span class="h5 block m-t-xs text-success-lt">Thời khóa biểu</span>

                                    </span>
                                </a>
                            </div> 
                            <div id="menutop_phonghoc" class="item-menu col-md-2 b-r m-t-xs m-b-xs item-active">
                                <a href="/Default.aspx?mod=lophoc!phonghoc" class="block hover">
                                    <span class="i-s i-s-1-5x pull-left m-r-xs">
                                        <i class="i i-hexagon2 i-s-base text-info hover-rotate"></i>
                                        <i class="fa fa-th icon text-white i-sm"></i>
                                    </span>
                                    <span class="clear">
                                        <span class="h5 block m-t-xs text-info">Phòng học</span>
                                        <small class="text-muted">Quản lý</small>
                                    </span>
                                </a>
                            </div>

                            <div id="menutop_lophoc_baihoc" class="item-menu col-md-2 b-r m-t-xs m-b-xs">
                                <a href="/Default.aspx?mod=lophoc!lophoc_baihoc" class="block hover">
                                    <span class="i-s i-s-1-5x pull-left m-r-xs">
                                        <i class="i i-hexagon2 i-s-base text-info  hover-rotate"></i>
                                        <i class="fa fa-book icon text-white i-sm"></i>
                                    </span>
                                    <span class="clear">
                                        <span class="h5 block m-t-xs text-info ">Bài học</span>
                                        <small class="text-muted">Theo lớp</small>
                                    </span>
                                </a>
                            </div>

                        </div>
                    </div>
                </div>
            </div>


            <span id="ctl10_menutop_script_menutop"> </span>
            <section class="scrollable wrapper">
                <div class="row">
                    <div class="col-lg-12 col-md-12">

                        <section class="panel panel-default">
                        <div class="panel-heading">
                            <p class="inline m-b-xs m-t-xs font-bold">

                                DANH SÁCH PHÒNG HỌC
                            </p>
                            <div class="pull-right">

                                <a href="" class="btn btn-default btn-sm themphonghoc"><i class="i i-plus2 "></i> Thêm phòng học</a>
                                &nbsp;
                                <div class="row wrapper">
                        <form method="post" id="form-timchinhanh">
                            @csrf
                                <select name="timchinhanh" id="timchinhanh"  class="form-control pull-right" style="width:150px">
                                    <option value="0">Tất cả</option>
                                    @foreach($chinhanh as $cn)
                                    <option value="{{$cn->id}}">{{$cn->ten}}</option>
                                    @endforeach
                                </select>
                        </form>
                                </div>
                            </div>
                            <div class="clearfix"></div>
</div>


                            <div class="table-responsive">



                                <!--contenttitle-->
                                <div id="containTB">
                                    <table cellpadding="0" cellspacing="0" border="0" class="stdtable" id="dyntable">
                                        <colgroup>
                                            <col class="con0">
                                            <col class="con1">
                                            <col class="con0">
                                            <col class="con1">
                                            <col class="con0">
                                            <col class="con0">
                                            <col class="con0">
                                            <col class="con0">
                                        </colgroup>
                                        <thead>
                                            <tr>
                                                <th class="head1" style="width: 50px">STT</th>
                                                <th class="head1">Tên</th>
                                                <th class="head1">Mô tả</th>              
                                                <th class="head1" style="width: 150px">Action</th>
                                            </tr>
                                        </thead>

                                        <tbody id="showlist"> 

                                           @foreach($phonghoc as $ph )
                                           <tr>
                                            <td>{{$loop->index+1}}</td>
                                            <td>{{$ph->ten}}</td>
                                            <td> 
                                                <b>{{$ph->mota}}</b> 
                                            </td>
                                            <td>   
                                                <a onclick="event.preventDefault();editphonghoc({{$ph->id}})" class=" edit btn btn-default btn-sm m-r-xs" value="{{$ph->id}}"><i class="fa fa-pencil"></i>Sửa</a>     
                                                <a  href="{{ route('ajax_xoaphonghoc',$ph->id) }}" class="btn btn-default btn-sm m-r-xs js-xoaphonghoc"><i class="fa fa-times"></i>Xóa</a>
                                            </td>
                                        </tr>
                                        @endforeach


                                    </tbody>
                                </table>

                            </div>
                        </div> 
                    </section>
                </div>
            </div>
        </section> 
    </section> 



    <!-- /.vbox -->
</section>
<!-- /.section-layout-2 -->

</section>
<!-- /.hbox.stretch -->

</section>


<!-- modal thêm phong hoc -->
<div class="modal fade" id="modal-themphonghoc">
   <div class="modal-dialog modal-lg">
    <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
            <h4 class="modal-title">Thêm mới phòng học</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
            <form action="" method="POST" id="form-themphonghoc" enctype="multipart/form-data">
                @csrf


                <div class="col-sm-12"> 
                    <div class="form-group">
                        <label class="control-label">Chi nhánh</label>
                        <select name="chinhanh" id="chinhanh" class="form-control"> 
                            @foreach($chinhanh as $cn)
                            <option value="{{$cn->id}}">{{$cn->ten}}</option>
                            @endforeach
                        </select>
                        <span class="error-form"></span>
                    </div> 
                </div>
                <div class="col-sm-12"> 
                    <div class="form-group">
                        <label class="control-label">Tên phòng</label>
                        <input type="text" name="namephonghoc"  class="form-control">
                        <span class="error-form"></span>
                    </div> 
                </div>
                <div class="col-sm-12"> 
                    <div class="form-group">
                        <label class="control-label">Mô tả</label>
                        <input type="text" name="mota"  class="form-control">
                        <span class="error-form"></span>
                    </div> 
                </div>
                <div class="col-sm-12"> 
                    <div class="form-group">
                        <label class="control-label">Trang thiết bị</label>

                        <textarea  name="thietbi" id="editor1"></textarea>


                        <span class="error-form"></span>
                        <input type="hidden" name="test" id="test1">
                    </div> 
                </div>


                <div class="clearfix" style="clear:both;height:30px;text-align:center"> 
                </div>

                <button type="submit" class="btn btn-primary js-btn-themphonghoc">thêm mới</button>
            </form>
        </div>
    </div>
</div>
</div>
<!-- sửa phòng hoc -->
<div class="modal fade" id="modal-suaphonghoc">
   <div class="modal-dialog modal-lg">
    <div class="modal-content">

        <!-- Modal Header -->
        <div class="modal-header">
            <h4 class="modal-title">Chỉnh sửa phòng học</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
            <form action="" method="POST" id="form-suaphonghoc" enctype="multipart/form-data">
                @csrf
 

                <div class="col-sm-12"> 
                    <div class="form-group">
                        <select name="chinhanh" id="chinhanh" class="form-control"> 
                            @foreach($chinhanh as $cn)
                            <option value="{{$cn->id}}">{{$cn->ten}}</option>
                            @endforeach
                        </select>
                        <span class="error-form"></span>
                    </div> 
                </div>
                <div class="col-sm-12"> 
                    <div class="form-group">
                        <label class="control-label">Tên phòng</label>
                        <input type="text" name="namephonghoc"  class="form-control">
                        <span class="error-form"></span>
                    </div> 
                </div>
                <div class="col-sm-12"> 
                    <div class="form-group">
                        <label class="control-label">Mô tả</label>
                        <input type="text" name="mota"  class="form-control">
                        <span class="error-form"></span>
                    </div> 
                </div>
                <div class="col-sm-12"> 
                    <div class="form-group">
                        <label class="control-label">Trang thiết bị</label>

                        <textarea  name="thietbi" id="editor2"></textarea>


                        <span class="error-form"></span>
                        <input type="hidden" name="test" id="test2">
                    </div> 
                </div>
                <input type="hidden" name="id">

                <div class="clearfix" style="clear:both;height:30px;text-align:center"> 
                </div>

                <button type="submit" class="btn btn-primary js-btn-suaphonghoc">Chỉnh sửa</button>
            </form>
        </div>
    </div>
</div>
</div>


@endsection
@section('script')
<script> CKEDITOR.replace('editor1'); </script>
<script> CKEDITOR.replace('editor2'); </script>

<script type="text/javascript">
                // thêm phòng hoc
                $(function(){
                    $('.themphonghoc').click(function(event){
                        event.preventDefault();
                        $("#modal-themphonghoc").modal('show');
                    })
                    let URL = '{{ route('ajax_post.themphonghoc') }}'
                    $('.js-btn-themphonghoc').click(function (e){
                        e.preventDefault();
                        let a=CKEDITOR.instances.editor1.getData();
                        $("#test1").attr('value',a);

                        let $this = $(this);
                        let $domForm = $this.closest('#form-themphonghoc');

                        $.ajax({
                            url: URL,
                            data: new FormData($("#modal-themphonghoc form")[0]),
                            contentType: false,
                            processData: false,
                            method : "POST",
                        }).done(function (data) {
                            $("#modal-themphonghoc").modal('hide');
                            $("#form-themphonghoc")[0].reset();
                            $('tbody').html(data);
                        }).fail(function (data) {
                            var errors = data.responseJSON;
                            $.each(errors.errors, function (i, val) {
                                $domForm.find('input[name=' + i + ']').siblings('.error-form').text(val[0]);
                            });
                        });
                    });
                })
// sua phong hoc
        function editphonghoc(ph) {

    $.ajax({

        type: 'GET',
        url: 'http://localhost/alibaba/public/lop-hoc/suaphonghoc/' + ph,
        success: function(data) { 
            $("#form-suaphonghoc input[name=namephonghoc]").val(data.ph.ten);
            $("#form-suaphonghoc input[name=mota]").val(data.ph.mota);
            $("#form-suaphonghoc input[name=thietbi]").val(data.ph.thietbi);
             $("#form-suaphonghoc input[name=id]").val(data.ph.id);
            
              $('#form-suaphonghoc #chinhanh option').each(function() {
                     if($(this).val() == data.ph.idchinhanh) {
                     $(this).prop("selected", true);
               }
             });
             CKEDITOR.instances.editor2.setData(data.ph.trangthietbi);

        
            $('#modal-suaphonghoc').modal('show');
        },
        error: function(data) {
            console.log(data);
        }
    });
}
$(function () {
     
        $('.js-btn-suaphonghoc').click(function (e) {
      e.preventDefault();
       let a=CKEDITOR.instances.editor2.getData();
     $("#test2").attr('value',a);
      let $this = $(this);
     let $domForm = $this.closest('#form-suaphonghoc');
     
          
            
      $.ajax({
        url: 'http://localhost/alibaba/public/lop-hoc/sua-phong-hoc/'+ $("#form-suaphonghoc input[name=id]").val(),
         data: new FormData($("#modal-suaphonghoc form")[0]),
                        contentType: false,
                        processData: false,
         method : "POST",
      }).done(function (data) {
        $("#modal-suaphonghoc").modal('hide');
        $("#form-suaphonghoc")[0].reset();
         $('tbody').html(data);
      }).fail(function (data) {
        var errors = data.responseJSON;
        $.each(errors.errors, function (i, val) {
          $domForm.find('input[name=' + i + ']').siblings('.error-form').text(val[0]);
        });
      });
    });
  })
            </script>
            <script type="text/javascript">
    
// xóa chi nhánh
  $(function () {
$('body').on("click",'.js-xoaphonghoc',function(event){
  event.preventDefault();
  let URL=$(this).attr('href');
 
    let $this=$(this);
    $.ajax({
        url: URL,
       
      }).done(function(results){
         if(results.code==200)
         {
            $this.parents("tr").remove();
         }
      }).fail(function (data) {
       
      });

})
})
  // tìm phòng theo chi nhanh
  $(function(){
     let URL = '{{ route('ajax_post.timphonghoc') }}'
     $('#timchinhanh').change(function (e) {

            e.preventDefault();
          
            let $this = $(this);

     let $domForm = $this.closest('#form-timchinhanh');
             
            
            $.ajax({
                url: URL,
                 data: new FormData($("form")[0]),
                        contentType: false,
                        processData: false,
         method : "POST",
            }).done(function (data) {
               
                
                 $('#showlist').html(data);
            }).fail(function (data) {
                var errors = data.responseJSON;
                $.each(errors.errors, function (i, val) {
                    $domForm.find('input[name=' + i + ']').siblings('.error-form').text(val[0]);
                });
            });
        });
  })
 
</script>
 @endsection